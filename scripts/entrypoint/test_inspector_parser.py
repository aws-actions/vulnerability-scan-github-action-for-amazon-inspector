import json
import unittest

import inspector_parser


def get_inspector_json(file):
    inspector_json = ""
    with open(file, "r") as f:
        inspector_json = json.load(f)
    return inspector_json


class TestInspectorParser(unittest.TestCase):

    def test_get_summarized_findings(self):
        inspector_scan = get_inspector_json("test_data/scan.json")
        findings = inspector_parser.get_summarized_findings(inspector_scan)
        for finding in findings:

            # Why are we using a list for package names and versions?
            # Because a single vulnerability finding can have multiple
            # affected packages and versions.
            for name in finding.package_names:
                self.assertTrue(name != "")

            for ver in finding.installed_versions:
                self.assertTrue(ver != "")

            self.assertTrue(finding.vulnerability_id != "")
            self.assertTrue(finding.cvss_severity != "")
            self.assertTrue(finding.cvss_score != "")

            for fixed in finding.fixed_versions:
                self.assertIsNotNone(fixed)

            self.assertTrue(finding.analysis_state != "")
            self.assertTrue(finding.advisories != "")

        inspector_parser.print_summarized_findings_as_table(findings)
        #inspector_parser.print_summarized_findings_as_json(findings)


if __name__ == '__main__':
    unittest.main()
